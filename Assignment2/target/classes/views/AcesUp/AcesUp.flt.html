<div id="header">
    <h1>Aces Up</h1>
    <div id="newGame">
        <button type="button">New Game</button>
    </div>
</div>
<br></br>
<br></br>
<br></br>






<link href="assets/css/AcesUp.css" rel="stylesheet">
<script type="text/javascript" src="/assets/webjars/jquery/2.1.3/jquery.js"></script>
<script type="text/javascript" src="/assets/webjars/jquery-ui/1.11.4/jquery-ui.js"></script>

<body>
    <div id="board">
<<<<<<< HEAD
        <div class="boardCol columnOfCards" id="col1">
        </div>
        <div class="boardCol columnOfCards" id="col2">
        </div>
        <div class="boardCol columnOfCards" id="col3">
        </div>
        <div class="boardCol columnOfCards" id="col4">
        </div>
        
        <!--<div class="boardCol">
            <div class="droppable">
            <div class="card" data-suit="spade" data-value="5" data-istop="0" data-hascard="1">
                <img src="assets/images/cardPics/5_of_spades.png" width="200" />
            </div>
            </div>
            <div class="droppable">
            <div class="card" data-suit="heart" data-value="7" data-istop="0" data-hascard="1">
                <img src="assets/images/cardPics/7_of_hearts.png" width="200" />
            </div>
            </div>
            <div class="droppable">
            <div class="card" data-suit="club" data-value="3" data-istop="0" data-hascard="1">
                <img src="assets/images/cardPics/3_of_clubs.png" width="200" />
            </div>
            </div>
            <div class="droppable">
            <div class="card draggable" data-suit="spade" data-value="3" data-istop="1" data-hascard="1">
                <img src="assets/images/cardPics/3_of_spades.png" width="200" />
            </div>
            </div>
        </div>
        <div class="boardCol">
            <div class="droppable">
            <div class="card" data-suit="spade" data-value="5" data-istop="0" data-hascard="1">
                <img src="assets/images/cardPics/5_of_spades.png" width="200" />
            </div>
            </div>
            <div class="droppable">
            <div class="card" data-suit="heart" data-value="7" data-istop="0" data-hascard="1">
                <img src="assets/images/cardPics/7_of_hearts.png" width="200" />
            </div>
            </div>
            <div class="droppable">
            <div class="card" data-suit="club" data-value="3" data-istop="0" data-hascard="1">
                <img src="assets/images/cardPics/3_of_clubs.png" width="200" />
            </div>
            </div>
            <div class="droppable">
            <div class="card draggable" data-suit="spade" data-value="3" data-istop="1" data-hascard="1">
                <img src="assets/images/cardPics/3_of_spades.png" width="200" />
            </div>
            </div>
        </div>
        <div class="boardCol">
            <div class="droppable">
            <div class="card" data-suit="spade" data-value="5" data-istop="0" data-hascard="1">
                <img src="assets/images/cardPics/5_of_spades.png" width="200" />
            </div>
            </div>
            <div class="droppable">
            <div class="card" data-suit="heart" data-value="7" data-istop="0" data-hascard="1">
                <img src="assets/images/cardPics/7_of_hearts.png" width="200" />
            </div>
            </div>
            <div class="droppable">
            <div class="card" data-suit="club" data-value="3" data-istop="0" data-hascard="1">
                <img src="assets/images/cardPics/3_of_clubs.png" width="200" />
            </div>
            </div>
            <div class="droppable">
            <div class="card draggable" data-suit="spade" data-value="2" data-istop="1" data-hascard="1">
                <img src="assets/images/cardPics/2_of_spades.png" width="200" />
            </div>
            </div>
        </div>
        <div class="boardCol">
            <div class="droppable">
            <div class="card" data-suit="spade" data-value="5" data-istop="0" data-hascard="1">
                <img src="assets/images/cardPics/5_of_spades.png" width="200" />
            </div>
            </div>
            <div class="droppable">
            <div class="card" data-suit="heart" data-value="7" data-istop="0" data-hascard="1">
                <img src="assets/images/cardPics/7_of_hearts.png" width="200" />
            </div>
            </div>
            <div class="droppable">
            <div class="card" data-suit="club" data-value="2" data-istop="0" data-hascard="1">
                <img src="assets/images/cardPics/2_of_clubs.png" width="200" />
            </div>
            </div>
            <div class="droppable">
            <div class="card draggable" data-suit="spade" data-value="2" data-istop="1" data-hascard="1">
                <img src="assets/images/cardPics/2_of_spades.png" width="200" />
            </div>
            </div>-->
        </div>
        <!--<tr class="sortable">
            <td>
                <div>
                <img src="assets/images/cardPics/5_of_spades.png" width ="200"/>
                </div>
            </td>
            <td>
                <div>
                <img src="assets/images/cardPics/7_of_hearts.png" width ="200"/>
                </div>
            </td>
            <td>
                <div>
                <img src="assets/images/cardPics/3_of_clubs.png" width ="200"/>
                </div>
            </td>
            <td> 
                <div>
                <img src="assets/images/cardPics/2_of_spades.png" width ="200"/>
                </div>
            </td>
        </tr>
        <tr class="sortable">
            <td>
                <div>
                <img src="assets/images/cardPics/5_of_spades.png" width ="200"/>
                </div>
            </td>
            <td> 
                <div>
                <img src="assets/images/cardPics/7_of_hearts.png" width ="200"/>
                <div>
            </td>
            <td> 
                <div>
                <img src="assets/images/cardPics/3_of_clubs.png" width ="200"/>
                </div>
            </td>
            <td>
                <div>
                <img src="assets/images/cardPics/2_of_spades.png" width ="200"/>
                </div>
            </td>
        </tr>-->
        </table>

=======

        <table id="columnOfCards">

        </table>

        <br></br>
        <br></br>
>>>>>>> 12123936ad60664988142506e285f92c592da216


        <div>
            <div id="inactiveCard">

            </div>

            <div id="activeCard">

            </div>

            <div id="buttons">
                <div id="deck">
<<<<<<< HEAD
                    <button id="dealButton" />
                    <h2>Deal</h2>
                </div>
                <div id="discard">
=======
                    <button id="dealButton"/>
                    <h2>Deal</h2>
                </div>
                <div class="droppable discard">
>>>>>>> 12123936ad60664988142506e285f92c592da216
                    <h2>Discard</h2>
                </div>
            </div>


        </div>
    </div>


<<<<<<< HEAD
=======
    <!--<BR>Remove from: <button id="Remove1">Column1</button><button id="Remove2">Column2</button><button id="Remove3">Column3</button><button id="Remove4">Column4</button>-->
>>>>>>> 12123936ad60664988142506e285f92c592da216

    <!--<BR>Move from column <input type="text" id="from_col"  /> to <input type="text" id="to_col"  /> <button id="moveButton">Move</button>-->

    <script>
<<<<<<< HEAD
        $( document ).ready(function() {        
        
var acesUp = (function() {
    game = null; // Object holds deck and current dealt colum
    curRow = 0; // iterator for deal function
    
    $.getJSON("http://localhost:8080/game", function( data ) {
    display(data);
    game = data;
    });
    
    $("#dealButton").click(function(){
    $.ajax({
      type: "POST",
      url: "/dealGame",
      data: JSON.stringify(game),
      success: function(data, status){console.log("Data: " + data + "\nStatus: " + status);
      game = data;
      display(data);
      },

      contentType:"application/json; charset=utf-8",
      dataType:"json",
  });
});


   
    

   $(".draggable").draggable({enabled:true, revert: true});

   

// $( ".sortable" ).sortable({
//   items: "> div"
// });




var display = function(game) {
    i = 1;
  
     
     game.cols.forEach(function(card) {
         
         
         console.log("Jquery results returning: ");
         console.log($("#col" + i).children(":last-child").children());
         
         if($("#col" + i).children(":last-child").children().is(':empty'))
         {
             $("#col" + i).children(":last-child").children().remove();
         } 
         
         
         
         
         $("#col" + i).children().children().attr("data-istop", 0);
         $("#col" + i).append('<div class="droppable"> <div class="card" data-suit="' + card[curRow].suit + '" data-value="' + card[curRow].value + '" data-istop="1" data-hascard="1"><img src="assets/images/cardPics/' + card[curRow].value + '_of_' + card[curRow].suit + '.png" width="200" /></div></div>');
         i++;
   
         
     }) 
     
     
         
    curRow++;
    
    $(".card").click(function() {
    checkDiscard($(this));
});

    
    updateDroppable();
    updateDraggable();
};



var checkDiscard = function(cardObj) {
    console.log("CHECK DISCARD IS BEING RUN");
    topCards = null;
    canDiscard = false;
    // console.log("Running checkDiscard with current card being: ");
    // console.log(cardObj);
    
    if(!parseInt(cardObj.attr("data-istop"))) { // if not on top, automagically not discardable
        return false;
    } else {
        topCards = getTopCards();
    }
    
    
    topCards.forEach(function(cmprCard) {
    // console.log("In compare cards, and comparing");
    // console.log(cardObj);
    // console.log("with");
    // console.log(cmprCard);
    
        if(cmprCard.attr("data-suit") === cardObj.attr("data-suit") &&
           parseInt(cmprCard.attr("data-value")) > parseInt(cardObj.attr("data-value"))) {
            canDiscard = true;
        }
        else {
        }
});
    
      if(canDiscard) {
            removeCard(cardObj);
      }
    // console.log("TopCards is:");
    // console.log(topCards);
    
    // console.log("isTop:");
    // console.log(cardObj.attr("data-istop"));
}



var removeCard = function(cardObj) {
    cardObj.parent().prev().children().attr("data-istop", 1);
    cardObj.attr("data-istop", 0);
    cardObj.attr("data-suit", " ");
    cardObj.attr("data-value", " ");
    cardObj.attr("data-hascard", 0);
    cardObj.empty();
    updateDroppable();
    updateDraggable();

    
    
    // make only the top cards draggable
    
    // make only the empty slots droppable
    
    // console.log("Calling RemoveCard");
    // cardObj.hide('slow', function(){ cardObj.remove(); });
};

var updateDraggable = function() {
    try {
    $currentDrag = $('#board div[data-istop="0"]');
    $nextDrag = $('#board div[data-istop="1"]');
    if ($currentDrag.data( "ui-draggable" )) {
        $currentDrag.draggable("destroy"); 
    }
    $currentDrag.removeClass("draggable");
    $currentDrag.removeClass("ui-draggable");
    $currentDrag.removeClass("ui-draggable-handle");
    
    // console.log("Next drag is: ");
    // console.log($nextDrag);
    $nextDrag.addClass("draggable");
    $nextDrag.draggable({
        revert: true
    });
    }
    catch(e) {
        null;
    }
    
    // $(function() {
    
    // });
    //  $(function() {
    //    $('#board div[data-istop="0"]').removeClass("draggable");
    // });
    //  $(function() {
    //    $('#board div[data-istop="1"]').addClass("draggable");
    // });
    //  $(function() {
    //    $(".draggable").draggable("enable"); 
    // });
}

var updateDroppable = function() {

    $('#board div[data-hascard="1"]').removeClass("droppable");
    $('#board div[data-hascard="0"]').addClass("droppable");
    
    
    $( ".droppable" ).droppable({
        accept: ".draggable",
        drop: function(event, ui) {
            // console.log("DROP EVENT BEING CALLED");
            // console.log("You dropped");
            // console.log(ui.draggable);
            
            // console.log("into");
            // console.log($(this));
            
           // switch the properties of the elements
           $(this).children().html(ui.draggable.html());
           $(this).children().droppable("destroy");
           $(this).children().removeClass("droppable");
           $(this).children().addClass("draggable");
           $(this).children().attr("data-hascard", 1);
           $(this).children().attr("data-istop", 1);
           $(this).children().attr("data-suit", ui.draggable.attr("data-suit"));
           $(this).children().attr("data-value", ui.draggable.attr("data-value"));
           $(this).children().html(ui.draggable.html());
           $(this).children().draggable({
               revert: true
           });
              
    
           
            ui.draggable.empty();
            ui.draggable.attr("style", " ") // reset the dragged card div back to original spot, for dropping in later
            
           $( document ).ready(function() {
            // make the old div has-card == 0, 
            // make the card above this one top
            ui.draggable.parent().prev().children().attr("data-istop", 1);
            ui.draggable.prev().addClass("draggable");
            ui.draggable.prev().draggable();
            ui.draggable.removeClass("draggable");
            ui.draggable.draggable("destroy");
            ui.draggable.addClass("droppable");

            ui.draggable.attr("data-hascard", 0);
            ui.draggable.attr("data-istop", 0);
            ui.draggable.attr("data-suit", " ");
            ui.draggable.attr("data-value", " ");
            
           $('#board div[data-hascard="1"]').removeClass("droppable");
           $('#board div[data-hascard="0"]').addClass("droppable");
         
           ui.draggable.droppable({
               accept: ".draggable"
           });
           
           ui.draggable.droppable("enable");
           
           });
            
            
            // make the old div is-top = 0
            
            // make the old div data-suit and data-value empty
            
            // change all those same attributes of the new div
            
            // pop the html out of the old div into the new div
            
            
        }
    });
    
 
    

 
    
}


var getTopCards = function() {
   topCards = [];
   
   $('#board div[data-istop="1"]').each(function() {
       topCards.push($(this));
   });
   
//    console.log("getTopCards function returning: ");
//    console.log(topCards);
   return topCards;
}

// $( ".topCard" ).draggable({
//   addClasses: true
// });

// $( ".topCard" ).draggable("enable");


    


    
    return {display: display, checkDiscard: checkDiscard, getTopCards: getTopCards, removeCard: removeCard, updateDraggable: updateDraggable, updateDroppable: updateDroppable}
    
}());
=======

    var game;
    var curRow = 0; // inc in dealDrag

    function genCols(game, rowNum) {
        $('#columnOfCards').append("<tr data-rownum = '"+rowNum+"'></tr>");

        for(var i = 0; i < 4; i++) {
            $('#columnOfCards tr[data-rownum="'+rowNum+'"]').append("<td class='droppable' data-colnum='"+i+"' data-hasCard='1' data-istop='1' data-suit='" +  (game.cols[i][curRow].suit.toLowerCase()) + "' data-value='" + (game.cols[i][rowNum].value) + "'> </td>");
           

            if($('#columnOfCards tr[data-rownum="'+ (rowNum - 1) +'"] td[data-colnum="'+i+'"]').attr("data-istop")){
                $('#columnOfCards tr[data-rownum="'+ (rowNum - 1) +'"] td[data-colnum="'+i+'"]').attr("data-istop", 0);
            }
        }

    }

    function display(game) {

        genCols(game, curRow);
        $('#columnOfCards tr[data-rownum="'+ curRow +'"] td').each(function( index ) {
            $(this).html('<img src="assets/images/cardPics/'+ game.cols[index][curRow].value +'_of_'+ game.cols[index][curRow].suit.toLowerCase() +'.png" width="250"/>');
        });
        checkMovable();
        activDragable();
    }

    function activDragable() {


        $( "td[data-istop='0'" ).draggable("disable");
       
        $( "td[data-istop='1'" ).each(function() {
            $(this).addClass("draggable");
        });

        $( ".draggable" ).draggable({
          addClasses: true
      });

         $( "td[data-istop='1'" ).draggable("enable");


        curRow++

    };
>>>>>>> 12123936ad60664988142506e285f92c592da216




    $("#dealButton").click(function(){
        $.ajax({
          type: "POST",
          url: "/dealGame",
          data: JSON.stringify(game),
          success: function(data, status){console.log("Data: " + data + "\nStatus: " + status);
          game = data;
          display(data);
      },

<<<<<<< HEAD
=======
      contentType:"application/json; charset=utf-8",
      dataType:"json",
  });
    });



    $( ".discard" ).droppable({
      drop: function(event, ui) {
    removeCard(ui.draggable);
}
});

    $('.droppable').droppable({
    drop: function(ev, ui) {
        foobar();
        //$(ui.draggable).detach().css({top: 0,left: 0}).appendTo(this);
    }
});
>>>>>>> 12123936ad60664988142506e285f92c592da216

    function foobar() {
        console.log("Dropped a card in a table cell!");
    }



<<<<<<< HEAD
=======


    $.getJSON("http://localhost:8080/game", function( data ) {
        display(data);
        game = data;
    }); 

    function removeCard(currentCard){
        if(checkMovable(currentCard)){
            currentCard.html(' ');
            console.log(currentCard);
            setPrevTop(currentCard);
            $(currentCard[0]).attr("data-hasCard", 0);
            $(currentCard[0]).attr("data-istop", 0);
            $(currentCard[0]).removeAttr("style");
        }
    };



    function setPrevTop(currentCard) {
        // currentCard[0].parentElement.children[currentCard[0].attributes[0]].attribute[2] = 1;
        // console.log(currentCard[0].parentElement.previousSibling.children[currentCard[0].attribute[0]].attribute[2]);

        console.log('td[data-colnum="' + parseInt(currentCard[0].attributes[0].nodeValue) + '"]');
       
       $(currentCard).parent().prev().children("td[data-colnum='" + parseInt(currentCard[0].attributes[0].nodeValue) + "']").attr("data-istop", 1);

       activDragable(); // bind Jquery UI dragable to newly draggable elements

    }

    function checkMovable(currentCard){
        numRows = curRow;
        $tableRows = $('#columnOfCards tr');
         $curCard = $(currentCard);


        for(i = 0; i < numRows; i++) {
            for(j = 0; j < 4; j++) {
                $comparitor = $tableRows[i].children[j];
                if(parseInt($comparitor.attributes[2].nodeValue)) {
                    if($comparitor.attributes[3].nodeValue == $curCard.attr("data-suit")) {
                         if((parseInt($comparitor.attributes[4].nodeValue) > (parseInt($curCard.attr("data-value"))))) {
                         return true;
                         }
                    }
                }
            }
        }
        return false;
    };

    // function removeCard(colNumber){
    //     $.ajax({
    //         type: "POST",
    //         url: "/removeCard/"+colNumber,
    //         data: JSON.stringify(game),
    //         success: function(data, status){console.log("Data: " + data + "\nStatus: " + status);
    //         game = data;
    //         display(data);},
    //         contentType:"application/json; charset=utf-8",
    //         dataType:"json",
    //     });

    // }


    // $("#Remove1").click(function(){
    //     removeCard(0);
    // });
    // $("#Remove2").click(function(){
    //     removeCard(1);
    // });
    // $("#Remove3").click(function(){
    //     removeCard(2);
    // });
    // $("#Remove4").click(function(){
    //     removeCard(3);
    // });


    // $("#moveButton").click(function(){
    //     var colFrom = $("#from_col").val();
    //     var colTo = $("#to_col").val();
    //     $.ajax({
    //       type: "POST",
    //       url: "/moveCard/"+colFrom+"/"+colTo,
    //       data: JSON.stringify(game),
    //       success: function(data, status){console.log("Data: " + data + "\nStatus: " + status);
    //       game = data;
    //       display(data);},
    //       contentType:"application/json; charset=utf-8",
    //       dataType:"json",
    //   });
    // });
>>>>>>> 12123936ad60664988142506e285f92c592da216


// function dealDrag(){
//     console.log("clicked deal");
//     for(var i = 0; i < 4; i++){
//         $('c' + i).addClass("setDrag")
//     }
// };





// function removeCard(colNumber){
//     $.ajax({
//         type: "POST",
//         url: "/removeCard/"+colNumber,
//         data: JSON.stringify(game),
//         success: function(data, status){console.log("Data: " + data + "\nStatus: " + status);
//         game = data;
//         display(data);},
//         contentType:"application/json; charset=utf-8",
//         dataType:"json",
//     });

// }


// $("#Remove1").click(function(){
//     removeCard(0);
// });
// $("#Remove2").click(function(){
//     removeCard(1);
// });
// $("#Remove3").click(function(){
//     removeCard(2);
// });
// $("#Remove4").click(function(){
//     removeCard(3);
// });


// $("#moveButton").click(function(){
//     var colFrom = $("#from_col").val();
//     var colTo = $("#to_col").val();
//     $.ajax({
//       type: "POST",
//       url: "/moveCard/"+colFrom+"/"+colTo,
//       data: JSON.stringify(game),
//       success: function(data, status){console.log("Data: " + data + "\nStatus: " + status);
//       game = data;
//       display(data);},
//       contentType:"application/json; charset=utf-8",
//       dataType:"json",
//   });
// });

}); // End of document.ready
    </script>



</body>

</html>